{% extends "base.html" %}

{% block title %}داشبورد اصلی - سامانه CRM{% endblock %}

{% block content %}
<article>
    <header><h1>ثبت تیکت جدید</h1></header>
    <form action="{{ url_for('create') }}" method="POST">
        <div class="grid">
            <label for="student_code">
                حلی کد دانش‌آموز
                <input type="text" id="student_code" name="student_code" required>
            </label>
            <label for="title">
                عنوان مشکل
                <input type="text" id="title" name="title" required>
            </label>
        </div>
        <label for="department_id">بخش مربوطه</label>
        <select id="department_id" name="department_id" required>
            <option value="" disabled selected>یک بخش را انتخاب کنید...</option>
            {% for department in departments %}
                <option value="{{ department.id }}">{{ department.name }}</option>
            {% endfor %}
        </select>
        <label for="description">شرح کامل مشکل</label>
        <textarea id="description" name="description" rows="4" required></textarea>
        <button type="submit">ثبت تیکت</button>
    </form>
</article>

<section style="margin-top: 2rem;">
    <h2>لیست تیکت‌های ثبت شده</h2>
    {% if tickets %}
    <figure>
        <table role="grid">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>عنوان</th>
                    <th>بخش</th>
                    <th>وضعیت</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                <tr>
                    <td>{{ ticket.id }}</td>
                    <td><a href="{{ url_for('ticket_detail', ticket_id=ticket.id) }}">{{ ticket.title }}</a></td>
                    <td>{{ ticket.department.name }}</td>
                    <td><mark>{{ ticket.status }}</mark></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </figure>
    {% else %}
    <p>در حال حاضر هیچ تیکتی ثبت نشده است.</p>
    {% endif %}
</section>
{% endblock %}
