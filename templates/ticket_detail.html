{% extends "base.html" %}

{% block title %}جزئیات تیکت #{{ ticket.id }} - {{ ticket.title }}{% endblock %}

{% block head_extra %}
<style>
    .description-box { white-space: pre-wrap; padding: 1.5rem; border-radius: var(--border-radius); background-color: var(--code-background-color); border: var(--card-border); }
    .actions-section { margin-top: 2rem; }
    .actions-section fieldset { padding: 0; border: none; }
    .actions-section .grid { grid-gap: 0.5rem; }
    .danger-button { --background-color: var(--form-element-invalid-background-color); --border-color: var(--form-element-invalid-border-color); --color: var(--contrast); }
</style>
{% endblock %}

{% block content %}
<nav>
    <ul>
        <li><a href="{{ url_for('index') }}">&larr; بازگشت به داشبورد</a></li>
    </ul>
</nav>

<article>
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>{{ ticket.title }}</h1>
            <!-- دکمه ویرایش فقط برای سازنده تیکت یا ادمین نمایش داده می‌شود -->
            {% if current_user.id == ticket.creator_id or current_user.role == 'admin' %}
                <a href="{{ url_for('edit_ticket', ticket_id=ticket.id) }}" role="button" class="outline">ویرایش تیکت</a>
            {% endif %}
        </div>
        <p>
            <strong>شناسه تیکت:</strong> {{ ticket.id }} | 
            <strong>حلی کد:</strong> {{ ticket.student_code }} | 
            <strong>بخش:</strong> {{ ticket.department.name }} | 
            <strong>وضعیت:</strong> <mark>{{ ticket.status }}</mark>
        </p>
    </header>

    <h2>شرح کامل مشکل</h2>
    <div class="description-box">
        {{ ticket.description }}
    </div>

    {% if current_user.is_authenticated and current_user.role == 'admin' %}
    <footer class="actions-section">
        <hr>
        <div class="grid">
            <form action="{{ url_for('update_status', ticket_id=ticket.id) }}" method="POST">
                <fieldset>
                    <legend><strong>تغییر وضعیت</strong></legend>
                    <div class="grid">
                        <button type="submit" name="status" value="In Progress" class="secondary">در حال بررسی</button>
                        <button type="submit" name="status" value="Closed" class="contrast">بستن تیکت</button>
                    </div>
                </fieldset>
            </form>
            <form action="{{ url_for('delete_ticket', ticket_id=ticket.id) }}" method="POST" onsubmit="return confirm('آیا از حذف این تیکت اطمینان دارید؟');">
                <fieldset>
                    <legend><strong>عملیات خطرناک</strong></legend>
                    <button type="submit" class="danger-button">حذف کامل</button>
                </fieldset>
            </form>
        </div>
    </footer>
    {% endif %}
    
</article>
{% endblock %}
